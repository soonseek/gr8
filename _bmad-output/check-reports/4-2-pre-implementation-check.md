# Pre-Implementation Check Report: Story 4-2

**Story ID:** 4-2-historical-market-data
**Story Title:** ê³¼ê±° ì‹œì¥ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ccxt ê¸°ë°˜)
**Check Date:** 2026-01-20
**Status:** âœ… **PASS** (ì¤€ë¹„ ì™„ë£Œ - ëª¨ë“  êµ¬í˜„ í•­ëª©ì´ ëª…í™•íˆ ì •ì˜ë¨)

---

## Executive Summary

Story 4-2ëŠ” **ccxt ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œ ì‹œì¥ ë°ì´í„° ìˆ˜ì§‘ ì‹œìŠ¤í…œ êµ¬ì¶•**ì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤. ë¬¸ì„œ ê²€ì¦ ê²°ê³¼ ëª¨ë“  ACê°€ ëª…í™•í•˜ê²Œ ì •ì˜ë˜ì–´ ìˆìœ¼ë©°, ì˜ì¡´ì„± Storyë“¤ì´ ì™„ë£Œë˜ì–´ ê°œë°œì„ ì‹œì‘í•  ìˆ˜ ìˆëŠ” ìƒíƒœì…ë‹ˆë‹¤.

**ì£¼ìš” íŠ¹ì§•:**
- MVP: 5ê°œ ê±°ë˜ì†Œ Ã— 5ê°œ ë¬´ê¸°í•œ ì„ ë¬¼ ì‹¬ë³¼ = 25ê°œ ì¡°í•©
- ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™” (ìŠ¤ì¼€ì¤„ë§ëœ ìë™ ì—…ë°ì´íŠ¸)
- ë°ì´í„° ê°­(Gap) ê°ì§€ ë° ìë™ ë³µêµ¬
- ë°±ì—”ë“œ API ì—”ë“œí¬ì¸íŠ¸ ì œê³µ

---

## Layer 1: ë¬¸ì„œ ë…¼ë¦¬ ê²€ì¦ (Document Logic Check)

### âœ… PASS: AC ì»¤ë²„ë¦¬ì§€

ëª¨ë“  ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ì´ 13ê°œì˜ ACë¡œ ëª…í™•íˆ ì •ì˜ë¨:

| AC | ë‚´ìš© | ìƒíƒœ |
|----|------|------|
| AC 1 | market_data DB í…Œì´ë¸” ìƒì„± | âœ… ëª…í™• |
| AC 2 | ccxt ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ ë° ì„¤ì • | âœ… ëª…í™• |
| AC 3 | MarketData SQLAlchemy ëª¨ë¸ êµ¬í˜„ | âœ… ëª…í™• |
| AC 4 | ccxt ê¸°ë°˜ ë°ì´í„° ìˆ˜ì§‘ ì„œë¹„ìŠ¤ êµ¬í˜„ (MVP: ë¬´ê¸°í•œ ì„ ë¬¼) | âœ… ëª…í™• |
| AC 5 | ë°±ì—”ë“œ API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„ | âœ… ëª…í™• |
| AC 6 | ë°ì´í„° ìºì‹± ë° incremental update | âœ… ëª…í™• |
| AC 7 | ë‹¤ì–‘í•œ ì‹œê°„í”„ë ˆì„ ì§€ì› | âœ… ëª…í™• |
| AC 8 | MVP ë²”ìœ„ ë°ì´í„° ìˆ˜ì§‘ (25ê°œ ì¡°í•©) | âœ… ëª…í™• |
| AC 9 | ì—ëŸ¬ ì²˜ë¦¬ ë° ì‚¬ìš©ì í”¼ë“œë°± | âœ… ëª…í™• |
| AC 10 | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë° í†µí•© í…ŒìŠ¤íŠ¸ | âœ… ëª…í™• |
| AC 11 | **ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™” ìŠ¤ì¼€ì¤„ëŸ¬** ğŸ†• | âœ… ëª…í™• |
| AC 12 | **ë°ì´í„° ê°­(Gap) ê°ì§€ ë° ìë™ ë³µêµ¬** ğŸ†• | âœ… ëª…í™• |
| AC 13 | **ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” API ì—”ë“œí¬ì¸íŠ¸** ğŸ†• | âœ… ëª…í™• |

### âœ… PASS: ì˜ì¡´ì„± ë§¤í•‘

| ì˜ì¡´ Story | ìƒíƒœ | í™•ì¸ ê²°ê³¼ |
|-----------|------|-----------|
| Story 1.2: ë°±ì—”ë“œ ìŠ¤íƒ€í„° í…œí”Œë¦¿ | âœ… DONE | FastAPI, PostgreSQL, Alembic êµ¬ì¶• ì™„ë£Œ |
| Story 3.2: ë…¸ë“œ íƒ€ì… ì •ì˜ | âœ… DONE | MarketDataNode ì¸í„°í˜ì´ìŠ¤ ì •ì˜ë¨ |

**ì˜ì¡´ì„± ê¹Šì´:** 2 (ì •ìƒ - 3 ì´í•˜ ê¶Œì¥)
- Story 4-2 â†’ Story 1.2 (depth 1)
- Story 4-2 â†’ Story 3.2 (depth 1)

### âœ… PASS: MVP ë²”ìœ„ ëª…í™•ì„±

**ê±°ë˜ì†Œ (5ê°œ):**
- Binance, OKX, Bybit, Gate.io, Bitget

**ì‹¬ë³¼ (5ê°œ, ëª¨ë‘ ë¬´ê¸°í•œ ì„ ë¬¼ Perpetual Futures):**
- BTC, ETH, SOL, XRP, DOGE

**ì´ 25ê°œ ì¡°í•©:**
- 5 ê±°ë˜ì†Œ Ã— 5 ì‹¬ë³¼ Ã— 6 timeframe = 150ê°œ ë°ì´í„° ìŠ¤íŠ¸ë¦¼

---

## Layer 2: ì‹¤ì œ êµ¬í˜„ ìƒíƒœ ê²€ì¦ (Implementation State Check)

### âŒ NOT STARTED: ëª¨ë“  êµ¬í˜„ í•­ëª©ì´ ë¯¸êµ¬í˜„ ìƒíƒœ

ì´ StoryëŠ” **ready-for-dev** ìƒíƒœë¡œ, ëª¨ë“  êµ¬í˜„ì´ ì²˜ìŒë¶€í„° ì‹œì‘ë˜ëŠ” ì‹ ê·œ ê°œë°œì…ë‹ˆë‹¤.

| êµ¬í˜„ í•­ëª© | í˜„ì¬ ìƒíƒœ | ì˜ˆìƒ íŒŒì¼ |
|----------|----------|-----------|
| requirements.txt (ccxt) | âŒ ì—†ìŒ | ccxt >= 4.0.0 ì¶”ê°€ í•„ìš” |
| requirements.txt (apscheduler) | âŒ ì—†ìŒ | apscheduler >= 3.10.0 ì¶”ê°€ í•„ìš” |
| market_data í…Œì´ë¸” migration | âŒ ì—†ìŒ | alembic/versions/xxx_add_market_data_table.py |
| sync_status í…Œì´ë¸” migration | âŒ ì—†ìŒ | alembic/versions/xxx_add_sync_status_table.py |
| MarketData ëª¨ë¸ | âŒ ì—†ìŒ | app/models/market_data.py |
| SyncStatus ëª¨ë¸ | âŒ ì—†ìŒ | app/models/sync_status.py |
| MarketData ìŠ¤í‚¤ë§ˆ | âŒ ì—†ìŒ | app/schemas/market_data.py |
| SyncStatus ìŠ¤í‚¤ë§ˆ | âŒ ì—†ìŒ | app/schemas/sync_status.py |
| MarketDataService | âŒ ì—†ìŒ | app/services/market_data_service.py |
| APScheduler | âŒ ì—†ìŒ | app/core/scheduler.py |
| MarketData API Router | âŒ ì—†ìŒ | app/api/routers/market_data.py |
| Admin auth dependency | âš ï¸ ë¶€ë¶„ êµ¬í˜„ë¨ | app/api/deps.py (get_current_admin_user ì¶”ê°€) |
| Main.py scheduler í†µí•© | âŒ ì—†ìŒ | app/main.py (lifespan ì¶”ê°€) |

**í™•ì¸ëœ ê¸°ì¡´ ë¦¬ì†ŒìŠ¤:**
- âœ… FastAPI ì•± êµ¬ì¡° (Story 1.2)
- âœ… PostgreSQL DB ì„¤ì • (Story 1.2)
- âœ… Alembic migration ì‹œìŠ¤í…œ (Story 1.2)
- âœ… Web3 ì¸ì¦ ì‹œìŠ¤í…œ (Story 8-1, 8-2)
- âœ… Admin ê¶Œí•œ ì‹œìŠ¤í…œ (Story 8-2)

---

## Layer 3: ì˜ì¡´ì„± ê·¸ë˜í”„ ë¶„ì„ (Dependency Graph Analysis)

### âœ… PASS: ìˆœí™˜ ì˜ì¡´ì„±

**ìˆœí™˜ ì˜ì¡´ì„± ì—†ìŒ:**
- Story 4-2ëŠ” Story 1.2, 3.2ì— ì˜ì¡´
- ì—­ë°©í–¥ ì˜ì¡´ì„± ì—†ìŒ

### âœ… PASS: Fan-out ë¶„ì„

**Story 4-2ì— ì˜ì¡´í•˜ëŠ” Stories:**
- Story 3-3: ì‹œì¥ ë°ì´í„° ë…¸ë“œ (í”„ë¡ íŠ¸ì—”ë“œ) - check-passed ìƒíƒœ
- Story 4-3: ì „ëµ ì‹¤í–‰ ì—”ì§„ - backlog
- Story 4-4: ì„±ê³¼ ë©”íŠ¸ë¦­ - backlog

**Fan-out: 3ê°œ** (ì •ìƒ - 5ê°œ ì´í•˜ ê¶Œì¥)

### âœ… PASS: ì˜ì¡´ì„± ê¹Šì´ ë¶„ì„

```
Story 4-2 (depth 0)
  â”œâ”€ Story 1.2 (depth 1) âœ… DONE
  â”‚   â””â”€ Story 1.1 (depth 2) âœ… DONE
  â””â”€ Story 3.2 (depth 1) âœ… DONE
      â”œâ”€ Story 3-1 (depth 2) âœ… DONE
      â””â”€ Story 3-1-1, 3-1-2 (depth 3) âœ… DONE
```

**ìµœëŒ€ ê¹Šì´:** 3 (ì •ìƒ - 3 ì´í•˜ ê¶Œì¥)

---

## Gap ë¶„ì„ (Gap Analysis)

### âœ… NO GAPS: ëª¨ë“  ê¸°ëŠ¥ì´ Storyì— ì •ì˜ë¨

Story 4-2ëŠ” ì™„ì „í•œ self-contained Storyë¡œ, ë³„ë„ì˜ Gap-Filler Storyê°€ í•„ìš” ì—†ìŠµë‹ˆë‹¤.

**í•„ìš”í•œ ëª¨ë“  ê¸°ëŠ¥ì´ ACì— í¬í•¨ë¨:**
1. DB ìŠ¤í‚¤ë§ˆ (market_data, sync_status)
2. ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ (ccxt, apscheduler)
3. ë°ì´í„° ëª¨ë¸ (MarketData, SyncStatus)
4. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (MarketDataService)
5. API ì—”ë“œí¬ì¸íŠ¸ (GET /data, POST /fetch, POST /sync, GET /sync/status)
6. ìŠ¤ì¼€ì¤„ëŸ¬ (APScheduler)
7. í…ŒìŠ¤íŠ¸ (ë‹¨ìœ„, í†µí•©)

---

## ì ì¬ì  ë¦¬ìŠ¤í¬ (Potential Risks)

### âš ï¸ ì£¼ì˜: ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ì¡´ì„±

**ccxt ë™ê¸° ë¼ì´ë¸ŒëŸ¬ë¦¬:**
- ccxtëŠ” async/awaitë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë™ê¸° ë¼ì´ë¸ŒëŸ¬ë¦¬
- FastAPIì˜ ë¹„ë™ê¸° í™˜ê²½ì—ì„œ ë¸”ë¡œí‚¹ ê°€ëŠ¥
- **ê¶Œì¥ í•´ê²°ì±…:** Dev Notesì— ëª…ì‹œëœ ëŒ€ë¡œ ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…ìœ¼ë¡œ ì²˜ë¦¬

### âš ï¸ ì£¼ì˜: Rate Limiting

**ê±°ë˜ì†Œ API Rate Limit:**
- Binance: 1200 requests/minute
- 25ê°œ ì¡°í•© Ã— 6 timeframe = 150ê°œ ë°ì´í„° ìŠ¤íŠ¸ë¦¼
- ìŠ¤ì¼€ì¤„ë§ ê°„ê²© ì¡°ì • í•„ìš” (ìµœì†Œ 1ì‹œê°„ ê¶Œì¥)

### âš ï¸ ì£¼ì˜: ë°ì´í„° ë³¼ë¥¨

**ì €ì¥ì†Œ ìš”êµ¬ì‚¬í•­:**
- 1ë¶„ë´‰ 1ê°œ ìº”ë“¤ â‰ˆ 100 bytes
- 1ì¼ â‰ˆ 1440 ìº”ë“¤ â‰ˆ 144 KB
- 25 ì¡°í•© Ã— 1ë…„ â‰ˆ 1.3 GB
- PostgreSQL ë””ìŠ¤í¬ ê³µê°„ ëª¨ë‹ˆí„°ë§ í•„ìš”

---

## ê¶Œì¥ ì‚¬í•­ (Recommendations)

### 1. ê°œë°œ ìˆœì„œ (Recommended Implementation Order)

1. **Task 1:** requirements.txtì— ccxt, apscheduler ì¶”ê°€
2. **Task 2:** DB ìŠ¤í‚¤ë§ˆ ìƒì„± (market_data, sync_status)
3. **Task 3:** SQLAlchemy ëª¨ë¸ êµ¬í˜„
4. **Task 4:** MarketDataService í•µì‹¬ ê¸°ëŠ¥ êµ¬í˜„
5. **Task 5:** API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
6. **Task 6:** APScheduler ì„¤ì • ë° í†µí•©
7. **Task 7:** ë°ì´í„° ê°­ ê°ì§€ ë° ë³µêµ¬
8. **Task 8:** ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” API
9. **Task 9:** í…ŒìŠ¤íŠ¸ ì‘ì„±
10. **Task 10:** MVP ë²”ìœ„ ë°ì´í„° ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸

### 2. í…ŒìŠ¤íŠ¸ ì „ëµ (Test Strategy)

**ë‹¨ìœ„ í…ŒìŠ¤íŠ¸:**
- ccxt fetch_ohlcv ëª¨í‚¹ (ì‹¤ì œ API í˜¸ì¶œ ë°©ì§€)
- DB ì €ì¥ ë¡œì§ í…ŒìŠ¤íŠ¸
- ê°­ ê°ì§€ ë¡œì§ í…ŒìŠ¤íŠ¸

**í†µí•© í…ŒìŠ¤íŠ¸:**
- API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
- ì‹¤ì œ ccxtë¡œ 25ê°œ ì¡°í•© í…ŒìŠ¤íŠ¸
- ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤í–‰ í…ŒìŠ¤íŠ¸

### 3. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ (Performance Monitoring)

**ì£¼ìš” ë©”íŠ¸ë¦­:**
- API ì‘ë‹µì‹œê°„ (< 200ms ëª©í‘œ)
- DB ì¿¼ë¦¬ ì„±ëŠ¥ (ì¸ë±ìŠ¤ í™œìš©)
- ccxt API í˜¸ì¶œ ì„±ê³µë¥ 
- ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤í–‰ ì‹œê°„

---

## ìµœì¢… íŒì • (Final Verdict)

### âœ… **PASS - READY FOR DEVELOPMENT**

**ì´ìœ :**
1. ëª¨ë“  ACê°€ ëª…í™•í•˜ê²Œ ì •ì˜ë¨ (13ê°œ AC)
2. ì˜ì¡´ì„± Storyë“¤ì´ ì™„ë£Œë¨ (Story 1.2, 3.2)
3. ì˜ì¡´ì„± ê·¸ë˜í”„ ê±´ì „í•¨ (ìˆœí™˜ ì—†ìŒ, ê¹Šì´ 3)
4. MVP ë²”ìœ„ ëª…í™•í•¨ (25ê°œ ì¡°í•©)
5. ì‹¤ì‹œê°„ ë™ê¸°í™” ê¸°ëŠ¥ ì™„ë²½í•˜ê²Œ ì •ì˜ë¨ (AC 11-13)
6. Dev Notesì— ì¶©ë¶„í•œ êµ¬í˜„ ê°€ì´ë“œ ì œê³µ
7. ë³„ë„ì˜ Gap-Filler Story í•„ìš” ì—†ìŒ

**ë‹¤ìŒ ë‹¨ê³„:**
- Story 4-2ë¥¼ **in-progress**ë¡œ ë³€ê²½í•˜ì—¬ ê°œë°œ ì‹œì‘
- Task 1ë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ êµ¬í˜„
- ì™„ë£Œ í›„ Story 3-3 (í”„ë¡ íŠ¸ì—”ë“œ) ê°œë°œ ê°€ëŠ¥

---

## ì²´í¬ë¦¬ìŠ¤íŠ¸ (Checklist)

### Layer 1: ë¬¸ì„œ ë…¼ë¦¬ ê²€ì¦
- [x] AC ì»¤ë²„ë¦¬ì§€ ì™„ì „ (13ê°œ AC)
- [x] ì˜ì¡´ì„± ë§¤í•‘ ì™„ë£Œ
- [x] MVP ë²”ìœ„ ëª…í™•
- [x] ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ ëª…í™•

### Layer 2: êµ¬í˜„ ìƒíƒœ ê²€ì¦
- [x] DB ìŠ¤í‚¤ë§ˆ ì •ì˜ ì™„ë£Œ
- [x] API ì—”ë“œí¬ì¸íŠ¸ ì •ì˜ ì™„ë£Œ
- [x] í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‹ë³„ ì™„ë£Œ
- [x] ëª¨ë¸/ì„œë¹„ìŠ¤ êµ¬í˜„ ê³„íš ì™„ë£Œ

### Layer 3: ì˜ì¡´ì„± ê·¸ë˜í”„ ë¶„ì„
- [x] ìˆœí™˜ ì˜ì¡´ì„± ì—†ìŒ
- [x] ì˜ì¡´ì„± ê¹Šì´ ì •ìƒ (depth 3)
- [x] Fan-out ì •ìƒ (3ê°œ)
- [x] ì˜ì¡´ì„± Story ì™„ë£Œë¨

### ì¶”ê°€ ê²€ì¦ í•­ëª©
- [x] ì‹¤ì‹œê°„ ë™ê¸°í™” ê¸°ëŠ¥ ì •ì˜ ì™„ë£Œ
- [x] ë°ì´í„° ê°­ ê°ì§€ ê¸°ëŠ¥ ì •ì˜ ì™„ë£Œ
- [x] ìŠ¤ì¼€ì¤„ëŸ¬ ê¸°ëŠ¥ ì •ì˜ ì™„ë£Œ
- [x] ë³´ì•ˆ ê³ ë ¤ì‚¬í•­ í¬í•¨ (admin ê¶Œí•œ)

---

**Checked by:** Claude Sonnet 4.5 (Pre-Implementation Check Workflow)
**Approved:** âœ… Ready for Development
**Date:** 2026-01-20
